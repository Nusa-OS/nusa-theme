#!/bin/bash
# Nusa OS V1 Beta - Identity Provider

# Branding OS
cat <<EOF > /etc/os-release
PRETTY_NAME="Nusa OS V1 Beta"
NAME="Nusa OS"
VERSION_ID="1.0"
VERSION="1.0 Beta"
ID=nusa
ID_LIKE=ubuntu
EOF

# Global XFCE Settings
mkdir -p /etc/skel/.config/xfce4/xfconf/xfce-perchannel-xml/

# Apply Arc-Darker and Papirus
cat <<EOF > /etc/skel/.config/xfce4/xfconf/xfce-perchannel-xml/xsettings.xml
<?xml version="1.0" encoding="UTF-8"?>
<channel name="xsettings" version="1.0">
  <property name="Net" type="empty">
    <property name="ThemeName" type="string" value="Arc-Darker"/>
    <property name="IconThemeName" type="string" value="Papirus"/>
  </property>
</channel>
EOF

# Desktop Wallpaper Configuration
cat <<EOF > /etc/skel/.config/xfce4/xfconf/xfce-perchannel-xml/xfce4-desktop.xml
<?xml version="1.0" encoding="UTF-8"?>
<channel name="xfce4-desktop" version="1.0">
  <property name="backdrop" type="empty">
    <property name="screen0" type="empty">
      <property name="monitor0" type="empty">
        <property name="workspace0" type="empty">
          <property name="last-image" type="string" value="/usr/share/backgrounds/nusa/default.jpg"/>
          <property name="image-style" type="int" value="5"/>
        </property>
      </property>
    </property>
  </property>
</channel>
EOF

# GNOME Schema Override
mkdir -p /usr/share/glib-2.0/schemas/
cat <<EOF > /usr/share/glib-2.0/schemas/99_nusa_wallpaper.gschema.override
[org.gnome.desktop.background]
picture-uri='file:///usr/share/backgrounds/nusa/default.jpg'
picture-options='zoom'
EOF
glib-compile-schemas /usr/share/glib-2.0/schemas/

# Permission Fix for Live User
cp -r /etc/skel/.config /home/nusa/ || true
chown -R nusa:nusa /home/nusa/ || true

exit 0
